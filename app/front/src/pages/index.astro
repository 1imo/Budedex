---
import Layout from '../components/layouts/Layout.astro';
import { getStrains } from '../services/graphql';
import PixelStrainCard from '../components/PixelStrainCard.astro';

// Fetch initial strains data
let strainsData = null;
let error = null;

try {
  strainsData = await getStrains(1, 12);
} catch (e) {
  error = e instanceof Error ? e.message : 'Failed to fetch strains';
}
---

<Layout title="Budedex - Cannabis Strain Database">
  <div class="container mx-auto px-4 py-16">
    <!-- Hero Section -->
    <section class="text-center mb-16 bg-card p-12 rounded-none">
      <h1 class="text-4xl font-bold lg:text-6xl mb-6 pixel-font uppercase tracking-wider leading-relaxed">
        CANNABIS STRAIN
        <span class="text-purple-600 block">DATABASE</span>
      </h1>
      <p class="text-lg max-w-2xl mx-auto mb-8 uppercase regular-font">
        DISCOVER, EXPLORE, AND LEARN ABOUT CANNABIS STRAINS. TRACK YOUR FAVORITES, BUILD YOUR WISHLIST, AND COMPETE ON THE LEADERBOARD.
      </p>
      <div class="flex gap-4 justify-center flex-wrap">
        <a href="/strains" class="pixel__button pixel-default__button box-shadow-margin text-sm font-medium px-8 py-3 uppercase">
          BROWSE STRAINS
        </a>
        <a href="/leaderboard" class="pixel__button pixel-secondary__button box-shadow-margin text-sm font-medium px-8 py-3 uppercase">
          VIEW LEADERBOARD
        </a>
      </div>
    </section>

    <!-- Featured Strains -->
    <section class="mb-12">
      <h2 class="text-3xl font-bold mb-8 pixel-font uppercase text-center">FEATURED STRAINS</h2>
      
      {error && (
        <div class="pixel__container bg-destructive text-destructive-foreground px-4 py-3 rounded-none mb-6 box-shadow-margin">
          <p class="pixel-font uppercase">ERROR LOADING STRAINS: {error}</p>
        </div>
      )}

      {strainsData && (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          {strainsData.strains.strains.slice(0, 8).map((strain: any) => (
            <PixelStrainCard strain={strain} />
          ))}
        </div>
      )}

      <div class="text-center mt-8">
        <a href="/strains" class="pixel__button pixel-secondary__button box-shadow-margin text-sm font-medium px-6 py-2 uppercase">
          VIEW ALL STRAINS
        </a>
      </div>
    </section>

  </div>
</Layout>
